<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cartographie de Projets</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" th:href="@{/manager/dashboard}"><i
                    class="bi bi-geo-alt-fill me-2"></i>Cartographie des Projets de Recherche — Gestion</a>
            <div class="navbar-text text-white ms-auto me-3">
                <i class="bi bi-person-circle me-2"></i>
                <span th:text="${user?.prenom + ' ' + user?.nom}"></span>
            </div>
            <form th:action="@{/logout}" method="post" class="d-inline">
                <button type="submit" class="btn btn-sm btn-outline-light">Déconnexion</button>
            </form>
        </div>
    </nav>

    <div class="container" style="padding-top: 100px;">

        <h2 class="mb-4" th:text="${project?.id != null} ? 'Modifier le projet' : 'Nouveau projet'">Nouveau projet</h2>

        <form th:action="@{/manager/projects/save}" th:object="${project}" method="post" class="needs-validation"
            novalidate>

            <input type="hidden" th:field="*{id}" />

            <div class="row g-4">
                <!-- Titre -->
                <div class="col-md-12">
                    <label class="form-label fw-bold">Titre du projet <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" th:field="*{titreProjet}" required />
                    <div class="invalid-feedback">Le titre est obligatoire</div>
                </div>

                <!-- Domaine -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Domaine de recherche</label>
                    <select class="form-select" th:field="*{domaineRecherche}">
                        <option value="">Choisir un domaine...</option>
                        <option th:each="domaine : ${domaines}" th:value="${domaine}" th:text="${domaine}"></option>
                    </select>
                </div>

                <!-- Institution -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Institution</label>
                    <input type="text" class="form-control" th:field="*{institution}" />
                </div>

                <!-- Responsable -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Responsable / Encadrant</label>
                    <input type="text" class="form-control" th:field="*{responsableProjet}" />
                </div>

                <!-- Budget -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Budget estimé (FCFA)</label>
                    <input type="number" class="form-control" th:field="*{budgetEstime}" min="0" step="1" />
                </div>

                <!-- Dates -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Date de début</label>
                    <input type="date" class="form-control" th:field="*{dateDebut}" />
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold">Date de fin prévue</label>
                    <input type="date" class="form-control" th:field="*{dateFin}" />
                </div>

                <!-- Avancement -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Niveau d'avancement (%)</label>
                    <input type="number" class="form-control" th:field="*{niveauAvancement}" min="0" max="100" />
                </div>

                <!-- Statut -->
                <div class="col-md-6">
                    <label class="form-label fw-bold">Statut</label>
                    <select class="form-select" th:field="*{statutProjet}">
                        <option value="EN_COURS">En cours</option>
                        <option value="SUSPENDU">Suspendu</option>
                        <option value="TERMINE">Terminé</option>
                    </select>
                </div>

                <!-- Participants -->
                <div class="col-12">
                    <label class="form-label fw-bold">Liste des participants (un par ligne)</label>
                    <textarea class="form-control" rows="5" th:field="*{listeParticipants}"
                        placeholder="Nom Prénom - Rôle&#10;Exemple : Jean Dupont - Chercheur principal"></textarea>
                </div>

                <!-- Description -->
                <div class="col-12">
                    <label class="form-label fw-bold">Description détaillée</label>
                    <textarea class="form-control" rows="8" th:field="*{description}"></textarea>
                </div>
            </div>

            <div class="mt-5 text-end">
                <a th:href="@{/manager/dashboard}" class="btn btn-outline-secondary me-2">Annuler</a>
                <button type="submit" class="btn btn-success">
                    <i class="bi bi-save me-1"></i>
                    <span
                        th:text="${project?.id != null} ? 'Enregistrer les modifications' : 'Créer le projet'">Créer</span>
                </button>
            </div>

        </form>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
        // Validation Bootstrap
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()
    </script>
</body>

</html>